---
layout: default
---
<script src="../js/download.js" type="module"></script>
<script>
    document.addEventListener("DOMContentLoaded", changeBgText);
</script>
<link rel="dns-prefetch" href="//cdn.mathjax.org" xmlns="http://www.w3.org/1999/html"/>
<link rel="stylesheet" href="../prism.css"/>
<style>
    .toc-container {
        position: fixed;
        left: 80%;
        max-width: 20%;
        max-height: calc(100% - 90px);
        overflow: auto;
        top: calc((100% - 90px) / 2);
        transform: translateY(-50%);
    }

    * {
        max-width: 100%;
    }

    .toc-container ul {
        list-style: none;
        padding-left: 20px;
    }

    .toc-container li {
        margin: 5px 0;
    }

    .page {
        max-width: 80%;
    }

    .heading-show {
        text-decoration: underline #ffffff solid 2px;
    }
</style>
<div class="toc-container">
    <h1>目录</h1>
    <div id="toc"></div>
</div>
<article class="page">
    <div id="page-header">
        <p>
        <h1 class="toc-ignore">{{ page.title }}</h1>
        <div class="meta" style="font-size: 12px;">
            创作日期：{{ page.date | date: "%Y年%m月%d日" }}
            <br/>
            创作者：{{ page.author }}
            <br/>
            分类：{{ page.class }}
            <br/>
            注：
            <br/>
            我的文章所有下载<a href="https://gitcode.com/Leo-hele/download_files/">内容</a>、<a
                href="https://gitee.com/Leo-hele/picGo-image">图片</a>均由<a href="https://gitcode.com">GitCode</a>、<a
                href="https://gitee.com">Gitee</a>托管，中国访问速度较快。如果您在国外，可以在官网下载。
            <br/>
            如果您发现内容有误或需要更新，请在<a href="https://github.com/Leo-hele/Leo-hele.github.io/issues">Github</a>上提交Issue、PR等，或<a
                href="mailto:{{ page.email }}?subject=建议">联系作者</a>，谢谢！
            <br/>
        </div>
        <a download="{{ page.title }}.html" id="download-html">下载html文件</a>
        <script>
            const a = document.getElementById("download-html");
            a.href = window.location.href;
        </script>
        <hr/>
    </div>
    <div id="md-file">
        {{ content }}
    </div>
</article>
<script>
    {% raw %}

    function addLiquid() {
        const md = document.getElementById("md-file");
        let res = md.innerHTML.replaceAll("{\\%", "{%");
        res = res.replaceAll("{\\{", "{{");
        md.innerHTML = res;
    }

    addLiquid();
    {% endraw %}

    function Query(className) {
        const mdfile = document.getElementById("md-file");
        const elements = mdfile.querySelectorAll(`${className}`);
        return elements;
    }

    function doSe(className, callback) {
        let elements = Query(className);
        if (elements === null) return;
        elements.forEach((element) => {
            callback(element);
        });
    }

    function new_innerHTML(parent, callback, addtag = true) {
        let tag = ["", ""];
        if (addtag) {
            tag = parent.outerHTML.split(parent.innerHTML);
        }
        let new_inner = tag[0];
        const children = parent.childNodes;
        const noTag = ['A'];

        children.forEach((celement) => {
            let element = celement;
            if ("tagName" in element && noTag.includes(element.tagName.toUpperCase())) {
                element.className += " " + 'heading-aa';
                new_inner += element.outerHTML;
            } else if (element.children) {
                new_inner += new_innerHTML(element, callback);
            } else {
                new_inner += callback(element);
            }
        });
        new_inner += tag[1];
        return new_inner;
    }

    function generateTOC() {
        const headings = Array.from(Query("h1, h2, h3, h4, h5, h6"))
            .filter(heading => heading.className !== 'toc-ignore')
            .map((heading, index) => {
                // 增强ID生成安全性
                let id = heading.textContent;
                id += `-heading${index}`;
                heading.id = id;
                return heading;
            });

        const tocContainer = document.getElementById('toc');
        let currentLevel = 1;
        let tocHTML = '<ul style="padding-left: 0">';
        headings.forEach((cheading, index) => {
            let heading = cheading;
            heading.className += "no-wrap";
            const id = cheading.id;
            heading.innerHTML = new_innerHTML(heading, (element) => {
                const text = `<a href="#${id}" class="heading-a">${element.textContent}</a>`;
                return text;
            }, false);
            const h$ = document.createElement("p");
            h$.className = "heading-show";
            h$.innerHTML = "#";
            h$.style.display = "none";
            heading.appendChild(h$);
            addLoad(() => {
                const h$ = heading.querySelector(".heading-show");
                heading.addEventListener("mouseenter", () => {
                    h$.style.display = "inline";
                });
                heading.addEventListener("mouseleave", () => {
                    h$.style.display = "none";
                });
            });
            const level = parseInt(heading.tagName.substring(1));
            heading.innerHTML = " ".repeat(level - 1) + heading.innerHTML;

            // 修复标签闭合逻辑
            if (level > currentLevel) {
                tocHTML += '<ul>'.repeat(level - currentLevel);
            } else if (level < currentLevel) {
                tocHTML += '</li></ul>'.repeat(currentLevel - level);
            } else if (index !== 0) {
                tocHTML += '</li>';
            }

            tocHTML += `<li><a href="#${id}">${heading.innerHTML}</a><hr/>`;
            currentLevel = level;
        });

        // 闭合最后未关闭的标签
        tocHTML += '</li></ul>';
        tocContainer.innerHTML = tocHTML;
        tocContainer.style.display = 'block';

        window.addEventListener('scroll', () => {
            const links = tocContainer.querySelectorAll('a');
            links.forEach(link => {
                if (link.className !== 'heading-a') return;
                const hash = link.getAttribute('href') || '';
                const id = hash.startsWith('#') ? hash.slice(1) : null;

                const heading = document.getElementById(id);
                if (!heading) {
                    console.warn('找不到对应标题:', id, '链接文本:', link.textContent);
                    return;
                }

                const rect = heading.getBoundingClientRect();
                link.classList.toggle('active', rect.top <= 100 && rect.bottom >= 100);
            });
        });
    }

    // 在页面加载完成后生成目录
    window.addEventListener('DOMContentLoaded', generateTOC);

    (function loadPrism() {
        const prismScript = document.createElement('script');
        prismScript.src = '../js/prism.js';

        prismScript.onload = function () {
            // 确保启用行号插件
            Prism.plugins.lineNumbers = true;

            // 注册下载按钮
            Prism.plugins.toolbar.registerButton('download', {
                text: '下载代码',
                onClick: function (env) {
                    downloadCode(env.code, env.language);
                }
            });

            Prism.highlightAll();
        };
        document.head.appendChild(prismScript);
    })();

    function setTag(className, tags) {
        doSe(className, (element) => {
            for (const key in tags) {
                element.setAttribute(key, tags[key]);
            }
        });
    }

    setTag("pre", {
        "class": "line-numbers",
    });
    setTag("code", {
        "data-prismjs-copy": "复制",
        "data-prismjs-copy-error": "复制失败",
        "data-prismjs-copy-success": "复制成功",
    });
    setTag("img", {
        "loading": "lazy",
        "decoding": "async",
        "class": "img-responsive",
    });
    doSe("img", img => {
        if (!img.hasAttribute('data-error-handled')) {
            img.setAttribute('data-error-handled', 'true');

            // 创建备用元素
            const fallback = document.createElement('div');
            fallback.className = 'image-fallback';
            fallback.innerHTML = `
                    <a href="${img.src}" target="_blank">图片加载失败！查看原图</a>
                `;
            fallback.style.display = 'none';

            // 包装图片
            const container = document.createElement('div');
            container.className = 'image-container';
            img.parentNode.insertBefore(container, img);
            container.appendChild(img);
            container.appendChild(fallback);

            // 添加错误处理
            img.addEventListener('error', () => {
                fallback.style.display = 'block';
            });
        }
    });
    MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
            skipHtmlTags: [            //  HTML tags that won't be searched for math
                'script', 'noscript', 'style', 'textarea', 'pre',
                'code', 'annotation', 'annotation-xml'
            ],
            enableMenu: false,
        }
    };

    addLoad(function () {
        document.querySelectorAll("a").forEach((item) => {
            let url = item.href;
            if (!url.startsWith("{{ site.url }}")) {
                item.target = "_blank";
                item.href = "{{ site.url }}/link.html?url=" + url;
            }
        })
    })
</script>
<script id="MathJax-script" async
        src="../js/mathjax/es5/tex-chtml.js">
</script>